<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>聊天室</title>
</head>
<body>
<h2>聊天室</h2>
<div id="chat" style="border:1px solid #ccc; height:300px; overflow-y:scroll;"></div>
<input id="msg" type="text" placeholder="输入消息" style="width: 80%"/>
<button onclick="send()">发送</button>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const room = urlParams.get("room") || "default";
    const user = urlParams.get("user") || "匿名";
    const ws = new WebSocket(`ws://localhost:9999/url/chat/ws?room=${room}&user=${user}`);

    ws.onmessage = function (event) {
        const data = JSON.parse(event.data);
        const div = document.createElement("div");
        div.textContent = `[${data.time}] ${data.from}: ${data.content}`;
        document.getElementById("chat").appendChild(div);
    };

    function send() {
        const input = document.getElementById("msg");
        ws.send(JSON.stringify({ content: input.value }));
        input.value = "";
    }
</script>
</body>
</html>